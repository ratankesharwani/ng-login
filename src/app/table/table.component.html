<form class="container my-4 p-4 border rounded shadow-sm bg-light">
  <div class="mb-4 row align-items-center">
    <label for="table-complete-search" class="col-sm-3 col-form-label">Full text search:</label>
    <div class="col-sm-6">
      <input
        id="table-complete-search"
        type="text"
        class="form-control"
        name="searchTerm"
      />
    </div>
    <div class="col-sm-3 text-end">
      <span *ngIf="service.loading$ | async" class="form-text text-muted">Loading...</span>
    </div>
  </div>

  <div class="table-responsive border rounded bg-white">
    <table class="table table-striped table-bordered mb-0">
      <thead class="table-light">
      <tr>
        <th scope="col">#</th>
        @for (column of tableHeader; track column.key) {
          @if (column.show) {
            <th
              scope="col"
              [class]="column.className"
              (click)="column.sortable ? onSort(column.key) : null"
              [attr.sortable]="column.sortable ? column.key : null"
              style="cursor: pointer"
            >
              {{ column.header }}
              @if (column.sortable) {
                <span>
        <span *ngIf="queryParams.sortBy === column.key && queryParams.direction === 'asc'">▲</span>
        <span *ngIf="queryParams.sortBy === column.key && queryParams.direction === 'desc'">▼</span>
        <span *ngIf="queryParams.sortBy !== column.key || queryParams.direction === ''">⇅</span>
      </span>
              }
            </th>
          }
        }
      </tr>
      <tr>
        <th></th>
        @for (column of tableHeader; track column.key) {
          @if (column.show) {
            <td>
              @if (column.sortable) {
                <input
                  type="text"
                  class="form-control form-control-sm"
                  [placeholder]="'Search ' + column.header"
                  [(ngModel)]="queryParams.filters[column.key]"
                  (ngModelChange)="onFilterChange()"
                  name="{{ column.key }}"
                />
              }
            </td>
          }
        }
      </tr>
      </thead>
      <tbody>
        @for (row of tableData?.['content']; track row.id) {
          <tr>
            <th scope="row">{{ row.index }}</th>
            @for (column of tableHeader; track column.key) {
              @if (column.show) {
                <td>
                  <ngb-highlight
                    [result]="row[column.key]"
                    [term]="service.searchTerm"
                  />
                </td>
              }
            }
          </tr>
        } @empty {
          <tr>
            <td colspan="4" class="text-center text-muted">No data available</td>
          </tr>
        }
      </tbody>
    </table>
  </div>

  <div class="d-flex flex-column flex-md-row justify-content-between align-items-center mt-3 gap-3">
    <ngb-pagination
      [collectionSize]="queryParams.totalElements"
      [pageSize]="queryParams.size"
      (pageChange)="onPageChange($event - 1)"
      [maxSize]="3"
      [boundaryLinks]="true"
      [directionLinks]="true"
      size="sm">
    </ngb-pagination>
    <div class="d-flex align-items-center">
      <label for="pageSizeSelect" class="me-2 mb-0">Items per page:</label>
      <select
        id="pageSizeSelect"
        class="form-select"
        style="width: auto"
        name="pageSize"
        [(ngModel)]="queryParams.size"
        (ngModelChange)="onPageSizeChange($event)"
      >
        <option [ngValue]="5">5</option>
        <option [ngValue]="10">10</option>
        <option [ngValue]="15">15</option>
        <option [ngValue]="20">20</option>
        <option [ngValue]="25">25</option>
      </select>
    </div>
  </div>
</form>
